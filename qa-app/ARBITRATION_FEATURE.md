# 答案仲裁功能实现完成

## 功能概述
为公开问题添加了答案仲裁功能。当用户对已采纳的答案（最高赞答案）持有不同意见时，可以申请仲裁，邀请专家投票。如果超过50%的专家同意推翻，问题状态将从"已解决"回到"PK状态"。

## 核心机制

### 1. 仲裁触发条件
- 问题必须有已采纳的答案
- 任何用户都可以申请仲裁
- 需要说明仲裁理由
- 必须邀请至少3位专家（最多5位）

### 2. 投票规则
- 专家投票：同意推翻 vs 维持原判
- 判定标准：超过50%同意 = 推翻采纳
- 未达50% = 维持原采纳答案

### 3. 状态流转
```
已采纳答案 → 申请仲裁 → 投票中 → 投票结果
                              ↓
                    超过50% ← → 未达50%
                       ↓           ↓
                  回到PK状态   维持采纳
```

## 功能特点

### 1. 已采纳答案标识
**视觉标识**
- 绿色"已采纳答案"徽章
- 浅绿色背景高亮
- 显著区分其他答案

**操作按钮**
- 未申请仲裁：显示"申请仲裁"按钮
- 投票中：显示"仲裁投票中"黄色徽章
- 已推翻：显示"已推翻"红色徽章
- 所有状态都可点击"查看详情"

### 2. 申请仲裁弹窗
**信息说明**
- 蓝色提示框说明仲裁规则
- 清晰的流程说明

**仲裁理由**
- 多行文本输入框
- 必填项，需详细说明理由
- 最少100字符（建议）

**邀请专家**
- 显示可邀请的专家列表
- 每位专家显示：
  - 头像和姓名
  - 认证标识
  - 职称
  - 擅长领域
- 选择状态：
  - 未选：灰色边框
  - 已选：蓝色边框 + 蓝色背景 + 勾选图标
- 实时显示已选数量：已选 X/5 位
- 限制：最少3位，最多5位

**提交验证**
- 理由不能为空
- 至少选择3位专家
- 不满足条件时按钮禁用

### 3. 仲裁状态弹窗
**投票进度条**
- 绿色：同意推翻的比例
- 红色：维持原判的比例
- 实时显示百分比

**投票统计**
- 同意推翻：X 票（绿色指示器）
- 维持原判：X 票（红色指示器）
- 同意率百分比（大字显示）

**状态显示**
1. **投票中**
   - 黄色时钟图标
   - "等待专家投票中..."
   - 模拟投票按钮（测试用）

2. **仲裁通过**
   - 绿色勾选图标
   - "仲裁通过"标题
   - 说明：问题状态已回到PK状态

3. **仲裁未通过**
   - 红色叉号图标
   - "仲裁未通过"标题
   - 说明：维持原采纳答案

### 4. 专家系统
**专家信息**
- 姓名、头像
- 职称（如：Python架构师）
- 认证标识
- 擅长领域（如：Python开发）

**专家列表**
- 李明 - Python架构师 - Python开发
- 王芳 - 数据科学家 - 数据分析
- 赵强 - 技术总监 - 技术管理
- 刘洋 - AI工程师 - 机器学习
- 陈静 - 全栈开发 - Web开发

### 5. 状态联动
**PK进度条联动**
- 仲裁通过后，自动隐藏进度条
- 问题回到PK状态（未解决）
- 用户可以重新投票

**答案状态更新**
- 原采纳答案的"已采纳"标识移除
- 显示"已推翻"徽章
- 其他答案可以重新竞争采纳

## 使用流程

### 用户视角
1. 查看问题，看到已采纳答案
2. 认为答案有问题，点击"申请仲裁"
3. 填写仲裁理由（为什么认为答案不对）
4. 选择3-5位相关领域的专家
5. 提交仲裁申请
6. 等待专家投票
7. 查看投票结果

### 专家视角（待实现）
1. 收到仲裁邀请通知
2. 查看问题和已采纳答案
3. 查看仲裁理由
4. 投票：同意推翻 / 维持原判
5. 可以添加投票说明

## 技术实现

### 状态管理
```javascript
// 仲裁状态
const [arbitrationStatus, setArbitrationStatus] = useState(null);
// null: 未申请
// 'pending': 投票中
// 'rejected': 维持原判
// 'approved': 推翻采纳

// 投票数据
const [arbitrationVotes, setArbitrationVotes] = useState({
  agree: 0,      // 同意推翻
  disagree: 0,   // 维持原判
  total: 0       // 总票数
});

// 选中的专家
const [selectedExperts, setSelectedExperts] = useState([]);
```

### 核心函数
```javascript
// 提交仲裁申请
handleSubmitArbitration()

// 切换专家选择
toggleExpertSelection(expertId)

// 模拟投票（测试用）
simulateVoting()
```

### 判定逻辑
```javascript
const agreePercentage = (agreeVotes / totalVotes) * 100;

if (agreePercentage > 50) {
  // 仲裁通过，推翻采纳
  setArbitrationStatus('approved');
  setShowProgressBar(false); // 回到PK状态
} else {
  // 仲裁未通过，维持原判
  setArbitrationStatus('rejected');
}
```

## UI设计

### 颜色方案
- **已采纳**：绿色 (#22c55e)
- **投票中**：黄色 (#f59e0b)
- **已推翻**：红色 (#ef4444)
- **同意推翻**：绿色进度条
- **维持原判**：红色进度条

### 交互反馈
- 专家选择：点击切换，视觉高亮
- 按钮状态：禁用时灰色，可用时红色
- 投票进度：实时动画显示
- 结果展示：大图标 + 文字说明

## 数据结构

### 专家数据
```javascript
{
  id: 1,
  name: '李明',
  avatar: 'https://...',
  title: 'Python架构师',
  verified: true,
  expertise: 'Python开发',
  votes: 0  // 投票状态
}
```

### 投票数据
```javascript
{
  agree: 2,      // 同意推翻的票数
  disagree: 1,   // 维持原判的票数
  total: 3       // 总票数
}
```

## 后续优化建议

### 功能增强
1. ✅ 基础仲裁流程
2. ✅ 专家选择和投票
3. ✅ 状态显示和联动
4. 专家投票界面（专家端）
5. 仲裁历史记录
6. 仲裁理由展示
7. 专家投票说明
8. 仲裁时间限制
9. 仲裁费用机制
10. 仲裁结果通知

### 规则优化
1. 专家权重系统（不同专家投票权重不同）
2. 仲裁冷却期（防止频繁仲裁）
3. 仲裁门槛（需要一定声望才能申请）
4. 专家回避机制（利益相关者不能投票）
5. 多轮仲裁（第一次未通过可再次申请）

### 体验优化
1. 仲裁进度实时推送
2. 专家投票提醒
3. 仲裁结果公示
4. 仲裁理由评分
5. 专家投票理由展示

## 文件修改
- `qa-app/qa-native-app/src/screens/QuestionDetailScreen.js`
  - 添加仲裁相关状态管理
  - 添加已采纳答案标识和仲裁按钮
  - 添加申请仲裁弹窗
  - 添加仲裁状态弹窗
  - 添加专家选择功能
  - 添加投票进度显示
  - 添加状态联动逻辑
  - 添加所有相关样式

## 测试功能
- 点击已采纳答案上的"申请仲裁"按钮
- 填写仲裁理由
- 选择3-5位专家
- 提交申请
- 点击"模拟投票结果"查看效果
- 观察问题状态变化

## 注意事项
1. 仲裁功能仅对已采纳答案可用
2. 需要至少3位专家参与投票
3. 超过50%同意才能推翻采纳
4. 仲裁通过后问题回到PK状态
5. 模拟投票功能仅用于测试
