# 题库功能完成文档

## ✅ 功能概述

完成了智慧指数系统的题库管理功能，包括题库页面和上传题库功能。用户可以浏览平台推荐和用户上传的题库，也可以自己上传题库。

## 📋 实现内容

### 1. 题库页面 (QuestionBankScreen.js)

**路由**: `QuestionBank`

**入口**: 智慧指数详情页 → 点击"题库"按钮

#### 页面布局

**头部导航**:
- 返回按钮（左侧）
- 页面标题"题库"（中间）
- 上传按钮（右侧，橙色背景）

**标签栏**:
- 平台推荐标签（盾牌图标）
- 用户上传标签（用户图标）
- 选中标签显示橙色下划线

**题库卡片**:
每个题库卡片包含：
- 题库名称（带类型图标）
  - 平台推荐：盾牌图标（橙色）
  - 用户上传：用户图标（蓝色）
- 难度标签（右上角）
  - 入门：绿色背景
  - 进阶：蓝色背景
  - 高级：橙色背景
- 元信息：
  - 题目数量（文档图标）
  - 分类标签（文件夹图标）
  - 作者信息（用户图标）
- 操作按钮：
  - 开始考核（橙色按钮，播放图标）
  - 查看详情（文字链接，右箭头）

#### 模拟数据

**平台推荐题库**（4个）:
1. React Native基础知识 - 50题 - 入门 - 前端开发
2. JavaScript高级特性 - 40题 - 进阶 - 编程语言
3. React Hooks实战 - 35题 - 进阶 - 前端开发
4. TypeScript入门 - 45题 - 入门 - 编程语言

**用户上传题库**（3个）:
1. Node.js后端开发 - 30题 - 进阶 - 后端开发 - 张三
2. CSS布局技巧 - 25题 - 入门 - 前端开发 - 李四
3. Python数据分析 - 20题 - 进阶 - 数据科学 - 王五

### 2. 上传题库页面 (UploadBankScreen.js)

**路由**: `UploadBank`

**入口**: 题库页面 → 点击右上角"上传"按钮

#### 页面布局

**头部导航**:
- 返回按钮（左侧）
- 页面标题"上传题库"（中间）
- 提交按钮（右侧，橙色背景）

**题库信息区域**:
- 题库名称输入框（必填，带红色星号）
- 题目数量提示（蓝色信息卡片，自动统计）

**题目列表区域**:
- 添加题目按钮（右上角，橙色文字）
- 题目卡片列表

#### 题目卡片功能

**题目头部**:
- 题目序号（左侧）
- 删除题目按钮（右侧，红色垃圾桶图标）

**题目类型选择**:
- 判断题
- 单选题
- 多选题
- 三个按钮横向排列，选中状态显示橙色背景

**题目内容**:
- 题目内容输入框（必填，多行文本）
- 最小高度80px

**选项管理**:

**判断题**:
- 两个选项：正确/错误
- 单选形式，选中显示绿色勾选图标

**选择题**（单选/多选）:
- 默认4个选项（A/B/C/D）
- 每个选项包含：
  - 正确答案选择按钮（左侧，圆形图标）
  - 选项内容输入框（中间）
  - 删除选项按钮（右侧，红色叉号图标）
- 添加选项按钮（最多6个选项）
- 至少保留2个选项

#### 表单验证

**提交时验证**:
1. 题库名称不能为空
2. 所有题目内容不能为空
3. 至少保留一道题目

**删除限制**:
- 题目至少保留1道
- 选项至少保留2个
- 删除时自动调整正确答案索引

#### 交互功能

**添加题目**:
- 点击"添加题目"按钮
- 自动创建新题目卡片
- 默认为单选题，4个空选项

**删除题目**:
- 点击题目卡片右上角删除按钮
- 如果只剩1道题，提示"至少需要保留一道题目"

**添加选项**:
- 点击"添加选项"按钮
- 最多添加到6个选项
- 新选项自动添加到列表末尾

**删除选项**:
- 点击选项右侧删除按钮
- 至少保留2个选项
- 如果删除的选项是正确答案，自动调整为第一个选项

**切换题目类型**:
- 点击题目类型按钮切换
- 切换到判断题时，选项自动变为正确/错误
- 切换到选择题时，恢复默认4个选项

**提交题库**:
- 点击右上角"提交"按钮
- 验证通过后显示成功提示
- 自动返回题库页面

## 🎨 视觉设计

### 颜色方案
- **主色**: #f59e0b（橙色）- 按钮、选中状态
- **成功色**: #22c55e（绿色）- 入门难度、正确答案
- **信息色**: #3b82f6（蓝色）- 进阶难度、用户上传
- **警告色**: #ef4444（红色）- 删除按钮、必填标识
- **背景色**: #f9fafb（浅灰）- 页面背景
- **卡片色**: #ffffff（白色）- 卡片背景

### 图标使用
- 盾牌：shield-checkmark（平台推荐）
- 用户：person（用户上传）
- 文档：document-text-outline（题目数量）
- 文件夹：folder-outline（分类）
- 播放：play-circle（开始考核）
- 箭头：chevron-forward（查看详情）
- 添加：add-circle（添加题目/选项）
- 删除：trash-outline（删除题目）
- 关闭：close-circle（删除选项）
- 勾选：checkmark-circle（正确答案）
- 圆圈：ellipse-outline（未选中）

### 难度标签颜色
```javascript
const getDifficultyColor = (difficulty) => {
  switch (difficulty) {
    case '入门': return '#22c55e';  // 绿色
    case '进阶': return '#3b82f6';  // 蓝色
    case '高级': return '#f59e0b';  // 橙色
    default: return '#6b7280';      // 灰色
  }
};
```

## 📊 数据结构

### 题库数据
```javascript
{
  id: 1,
  name: 'React Native基础知识',
  questionCount: 50,
  author: '平台',              // 平台 或 用户名
  type: 'platform',            // platform: 平台推荐, user: 用户上传
  difficulty: '入门',          // 入门/进阶/高级
  category: '前端开发'
}
```

### 题目数据（上传时）
```javascript
{
  id: 1,
  title: '题目内容',
  type: 'single',              // judge: 判断题, single: 单选题, multiple: 多选题
  options: ['选项A', '选项B', '选项C', '选项D'],
  correctAnswer: 0             // 正确答案索引
}
```

## 🔄 交互流程

### 浏览题库
1. 从智慧指数详情页点击"题库"按钮
2. 进入题库页面，默认显示"平台推荐"标签
3. 点击标签切换查看"用户上传"题库
4. 浏览题库卡片，查看题库信息
5. 点击"开始考核"进入考核页面
6. 点击"查看详情"查看题库详情

### 上传题库
1. 在题库页面点击右上角"上传"按钮
2. 进入上传题库页面
3. 输入题库名称
4. 添加题目：
   - 点击"添加题目"按钮
   - 选择题目类型
   - 输入题目内容
   - 添加/删除选项
   - 选择正确答案
5. 重复步骤4添加更多题目
6. 点击右上角"提交"按钮
7. 验证通过后显示成功提示
8. 自动返回题库页面

## 📱 页面截图说明

### 题库页面
```
┌─────────────────────────────────┐
│ ← 题库              [+ 上传]     │
├─────────────────────────────────┤
│ [🛡️ 平台推荐] [👥 用户上传]     │
├─────────────────────────────────┤
│ ┌─────────────────────────────┐ │
│ │ 🛡️ React Native基础知识 [入门]│ │
│ │ 📄 50道题 📁 前端开发 👤 平台 │ │
│ │ [▶️ 开始考核] [查看详情 →]   │ │
│ └─────────────────────────────┘ │
│ ┌─────────────────────────────┐ │
│ │ 🛡️ JavaScript高级特性  [进阶]│ │
│ │ 📄 40道题 📁 编程语言 👤 平台 │ │
│ │ [▶️ 开始考核] [查看详情 →]   │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

### 上传题库页面
```
┌─────────────────────────────────┐
│ ← 上传题库              [提交]   │
├─────────────────────────────────┤
│ 题库信息                         │
│ 题库名称 *                       │
│ [                    ]          │
│ ℹ️ 题目数量：3 道                │
├─────────────────────────────────┤
│ 题目列表          [+ 添加题目]   │
│ ┌─────────────────────────────┐ │
│ │ 题目 1                  [🗑️] │ │
│ │ 题目类型                     │ │
│ │ [判断题][单选题][多选题]     │ │
│ │ 题目内容 *                   │ │
│ │ [                    ]      │ │
│ │ 选项          [+ 添加选项]   │ │
│ │ ○ [选项 A            ] [×]  │ │
│ │ ● [选项 B            ] [×]  │ │ ← 正确答案
│ │ ○ [选项 C            ] [×]  │ │
│ │ ○ [选项 D            ] [×]  │ │
│ └─────────────────────────────┘ │
└─────────────────────────────────┘
```

## 🔧 技术实现

### 1. 动态选项管理
```javascript
const addOption = (questionId) => {
  setQuestions(questions.map(q => {
    if (q.id === questionId && q.options.length < 6) {
      return { ...q, options: [...q.options, ''] };
    }
    return q;
  }));
};

const removeOption = (questionId, optionIndex) => {
  setQuestions(questions.map(q => {
    if (q.id === questionId && q.options.length > 2) {
      const newOptions = q.options.filter((_, index) => index !== optionIndex);
      return { 
        ...q, 
        options: newOptions,
        correctAnswer: q.correctAnswer >= optionIndex && q.correctAnswer > 0 
          ? q.correctAnswer - 1 
          : q.correctAnswer
      };
    }
    return q;
  }));
};
```

### 2. 表单验证
```javascript
const handleSubmit = () => {
  if (!bankName.trim()) {
    alert('请输入题库名称');
    return;
  }

  const invalidQuestions = questions.filter(q => !q.title.trim());
  if (invalidQuestions.length > 0) {
    alert('请完善所有题目的标题');
    return;
  }

  alert('题库上传成功！');
  navigation.goBack();
};
```

### 3. 平台兼容性
```javascript
if (Platform.OS === 'web') {
  alert('提示信息');
} else {
  Alert.alert('提示', '提示信息');
}
```

## 📄 相关文件

- `qa-app/qa-native-app/src/screens/QuestionBankScreen.js` - 题库页面
- `qa-app/qa-native-app/src/screens/UploadBankScreen.js` - 上传题库页面
- `qa-app/qa-native-app/src/screens/WisdomIndexScreen.js` - 智慧指数详情页（添加跳转）
- `qa-app/qa-native-app/App.js` - 路由配置
- `qa-app/QUESTION_BANK_FEATURE_COMPLETE.md` - 本文档

## 🎯 功能特点

1. **双标签切换**: 平台推荐和用户上传题库分开展示
2. **类型标识**: 清晰的图标和颜色区分题库来源
3. **难度分级**: 入门/进阶/高级三个难度等级
4. **完整信息**: 题目数量、分类、作者一目了然
5. **灵活上传**: 支持三种题型，动态管理选项
6. **表单验证**: 完善的验证机制，确保数据完整
7. **友好交互**: 清晰的操作反馈和提示信息
8. **响应式设计**: 适配不同屏幕尺寸

## ✅ 测试清单

- [x] 题库页面标签切换功能
- [x] 题库卡片信息展示
- [x] 类型图标和颜色显示
- [x] 难度标签颜色显示
- [x] 上传按钮跳转
- [x] 题库名称输入
- [x] 题目数量自动统计
- [x] 添加题目功能
- [x] 删除题目功能（最少1道）
- [x] 题目类型切换
- [x] 题目内容输入
- [x] 添加选项功能（最多6个）
- [x] 删除选项功能（最少2个）
- [x] 正确答案选择
- [x] 表单验证功能
- [x] 提交成功提示
- [x] 返回题库页面
- [x] Web端兼容性

## 🔄 后续优化建议

1. **题库详情页**: 显示题库中的所有题目预览
2. **题库编辑**: 允许用户编辑自己上传的题库
3. **题库删除**: 允许用户删除自己上传的题库
4. **题库搜索**: 添加搜索功能，快速查找题库
5. **题库筛选**: 按难度、分类筛选题库
6. **题库排序**: 按题目数量、创建时间排序
7. **题库评分**: 用户可以对题库进行评分
8. **题库收藏**: 收藏喜欢的题库
9. **题目预览**: 上传前预览题目效果
10. **批量导入**: 支持从文件批量导入题目

---

**实现时间**: 2026-01-27  
**实现内容**: 题库页面 + 上传题库功能  
**状态**: ✅ 已完成
