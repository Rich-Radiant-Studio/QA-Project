# é€€å‡ºç™»å½•å¼¹çª—æ˜¾ç¤ºé»˜è®¤å¯†ç åŠŸèƒ½

## åŠŸèƒ½è¯´æ˜

å½“ç”¨æˆ·ç‚¹å‡»é€€å‡ºç™»å½•æ—¶ï¼Œå¼¹çª—ä¼šæ ¹æ®ç”¨æˆ·æ˜¯å¦ä¿®æ”¹è¿‡å¯†ç æ¥å†³å®šæ˜¯å¦æ˜¾ç¤ºé»˜è®¤å¯†ç  `12345678`ã€‚

### æ˜¾ç¤ºé€»è¾‘

- **æœªä¿®æ”¹è¿‡å¯†ç **ï¼šæ˜¾ç¤ºé»˜è®¤å¯†ç  `12345678`
- **å·²ä¿®æ”¹è¿‡å¯†ç **ï¼šä¸æ˜¾ç¤ºé»˜è®¤å¯†ç 

## å®ç°ç»†èŠ‚

### 1. LogoutConfirmModal ç»„ä»¶

ä½ç½®ï¼š`src/components/LogoutConfirmModal.js`

æ–°å¢å‚æ•°ï¼š
- `showDefaultPassword` (boolean): æ˜¯å¦æ˜¾ç¤ºé»˜è®¤å¯†ç 

```javascript
<LogoutConfirmModal
  visible={showLogoutModal}
  onClose={() => setShowLogoutModal(false)}
  onConfirm={handleConfirmLogout}
  username={userProfile.username || userProfile.nickname}
  isLoading={isLoggingOut}
  showDefaultPassword={!userProfile.passwordChanged}  // å…³é”®å‚æ•°
/>
```

### 2. ProfileScreen ç”¨æˆ·ä¿¡æ¯

ä½ç½®ï¼š`src/screens/ProfileScreen.js`

ç”¨æˆ·ä¿¡æ¯çŠ¶æ€ä¸­æ–°å¢å­—æ®µï¼š
```javascript
const [userProfile, setUserProfile] = useState({
  // ... å…¶ä»–å­—æ®µ
  passwordChanged: false, // æ˜¯å¦ä¿®æ”¹è¿‡å¯†ç ï¼ˆé»˜è®¤ falseï¼‰
});
```

å­—æ®µæ›´æ–°é€»è¾‘ï¼š
```javascript
// ä» API å“åº”ä¸­è¯»å– passwordChanged å­—æ®µ
passwordChanged: freshProfile.passwordChanged === true,
```

**é‡è¦**ï¼šä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰åˆ¤æ–­ `=== true`ï¼Œç¡®ä¿åªæœ‰å½“ API æ˜ç¡®è¿”å› `true` æ—¶æ‰è®¤ä¸ºå¯†ç å·²ä¿®æ”¹ã€‚

### 3. API å“åº”å­—æ®µ

ä½ç½®ï¼š`src/services/api/userApi.js`

API æ¥å£ï¼š`/app/user/profile/me`

æœŸæœ›è¿”å›å­—æ®µï¼š
```json
{
  "code": 200,
  "data": {
    "userId": "...",
    "username": "...",
    "passwordChanged": true  // æˆ– false
  }
}
```

æ—¥å¿—è¾“å‡ºå·²æ·»åŠ  `passwordChanged` å­—æ®µçš„æ‰“å°ï¼Œæ–¹ä¾¿è°ƒè¯•ã€‚

### 4. ä¿®æ”¹å¯†ç åæ›´æ–°çŠ¶æ€

ä½ç½®ï¼š`src/screens/ChangePasswordScreen.js`

å½“ç”¨æˆ·æˆåŠŸä¿®æ”¹å¯†ç åï¼Œä¼šè‡ªåŠ¨æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼š

```javascript
// æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼šæ ‡è®°å¯†ç å·²ä¿®æ”¹
const cachedProfile = await AsyncStorage.getItem('userProfile');
if (cachedProfile) {
  const profile = JSON.parse(cachedProfile);
  profile.passwordChanged = true;
  await AsyncStorage.setItem('userProfile', JSON.stringify(profile));
}
```

è¿™æ ·ç¡®ä¿ç”¨æˆ·ä¿®æ”¹å¯†ç åï¼Œä¸‹æ¬¡é€€å‡ºç™»å½•æ—¶ä¸ä¼šå†æ˜¾ç¤ºé»˜è®¤å¯†ç ã€‚

## æ•°æ®æµç¨‹

```
1. ç”¨æˆ·ç™»å½•
   â†“
2. è°ƒç”¨ /app/user/profile/me è·å–ç”¨æˆ·ä¿¡æ¯
   â†“
3. è¯»å– passwordChanged å­—æ®µï¼ˆé»˜è®¤ falseï¼‰
   â†“
4. ç”¨æˆ·ç‚¹å‡»é€€å‡ºç™»å½•
   â†“
5. LogoutConfirmModal æ ¹æ® passwordChanged å†³å®šæ˜¯å¦æ˜¾ç¤ºé»˜è®¤å¯†ç 
   - passwordChanged === false â†’ æ˜¾ç¤ºé»˜è®¤å¯†ç  12345678
   - passwordChanged === true â†’ ä¸æ˜¾ç¤ºé»˜è®¤å¯†ç 
```

## åç«¯åè°ƒ

### å¦‚æœåç«¯æœªæä¾› passwordChanged å­—æ®µ

å½“å‰å®ç°å·²åšå¥½å…¼å®¹å¤„ç†ï¼š

```javascript
passwordChanged: freshProfile.passwordChanged === true
```

- å¦‚æœ API è¿”å› `passwordChanged: true` â†’ ä¸æ˜¾ç¤ºé»˜è®¤å¯†ç 
- å¦‚æœ API è¿”å› `passwordChanged: false` â†’ æ˜¾ç¤ºé»˜è®¤å¯†ç 
- å¦‚æœ API æœªè¿”å›è¯¥å­—æ®µï¼ˆundefinedï¼‰â†’ æ˜¾ç¤ºé»˜è®¤å¯†ç ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰

### å»ºè®®åç«¯å®ç°

åç«¯åº”åœ¨ `/app/user/profile/me` æ¥å£ä¸­è¿”å› `passwordChanged` å­—æ®µï¼š

```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "userId": "123456",
    "username": "testuser",
    "passwordChanged": false,  // æ–°å¢å­—æ®µ
    // ... å…¶ä»–å­—æ®µ
  }
}
```

åˆ¤æ–­é€»è¾‘ï¼š
- ç”¨æˆ·ä»æœªä¿®æ”¹è¿‡å¯†ç  â†’ `passwordChanged: false`
- ç”¨æˆ·è‡³å°‘ä¿®æ”¹è¿‡ä¸€æ¬¡å¯†ç  â†’ `passwordChanged: true`

## æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1ï¼šæ–°ç”¨æˆ·ï¼ˆæœªä¿®æ”¹å¯†ç ï¼‰

1. ä½¿ç”¨é»˜è®¤å¯†ç  `12345678` ç™»å½•
2. ç‚¹å‡»"æˆ‘çš„" â†’ "é€€å‡ºç™»å½•"
3. **é¢„æœŸ**ï¼šå¼¹çª—æ˜¾ç¤ºç”¨æˆ·åå’Œé»˜è®¤å¯†ç  `12345678`

### åœºæ™¯ 2ï¼šä¿®æ”¹å¯†ç å

1. è¿›å…¥"è®¾ç½®" â†’ "ä¿®æ”¹å¯†ç "
2. æˆåŠŸä¿®æ”¹å¯†ç 
3. ç‚¹å‡»"æˆ‘çš„" â†’ "é€€å‡ºç™»å½•"
4. **é¢„æœŸ**ï¼šå¼¹çª—åªæ˜¾ç¤ºç”¨æˆ·åï¼Œä¸æ˜¾ç¤ºé»˜è®¤å¯†ç 

### åœºæ™¯ 3ï¼šé€€å‡ºåé‡æ–°ç™»å½•

1. é€€å‡ºç™»å½•
2. ä½¿ç”¨æ–°å¯†ç é‡æ–°ç™»å½•
3. ç‚¹å‡»"æˆ‘çš„" â†’ "é€€å‡ºç™»å½•"
4. **é¢„æœŸ**ï¼šå¼¹çª—åªæ˜¾ç¤ºç”¨æˆ·åï¼Œä¸æ˜¾ç¤ºé»˜è®¤å¯†ç ï¼ˆå› ä¸º passwordChanged å·²ä¿å­˜ï¼‰

## è°ƒè¯•æ–¹æ³•

### æŸ¥çœ‹ API å“åº”

åœ¨ç»ˆç«¯ä¸­æŸ¥æ‰¾ä»¥ä¸‹æ—¥å¿—ï¼š

```
ğŸ“¥ /app/user/profile/me æ¥å£è¿”å›æ•°æ®:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
{
  "code": 200,
  "data": {
    ...
    "passwordChanged": false  // æŸ¥çœ‹æ­¤å­—æ®µ
  }
}
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“Š ç”¨æˆ·æ•°æ®å­—æ®µè¯¦æƒ…:
   ...
   passwordChanged: false (æ˜¯å¦ä¿®æ”¹è¿‡å¯†ç )
```

### æŸ¥çœ‹æœ¬åœ°ç¼“å­˜

åœ¨ ChangePasswordScreen ä¿®æ”¹å¯†ç æˆåŠŸåï¼ŒæŸ¥æ‰¾æ—¥å¿—ï¼š

```
âœ… å·²æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼špasswordChanged = true
```

## æ–‡ä»¶æ¸…å•

ä¿®æ”¹çš„æ–‡ä»¶ï¼š
1. `src/components/LogoutConfirmModal.js` - æ·»åŠ é»˜è®¤å¯†ç æ˜¾ç¤ºé€»è¾‘
2. `src/screens/ProfileScreen.js` - æ·»åŠ  passwordChanged å­—æ®µå¤„ç†
3. `src/services/api/userApi.js` - æ·»åŠ  passwordChanged å­—æ®µæ—¥å¿—
4. `src/screens/ChangePasswordScreen.js` - ä¿®æ”¹å¯†ç åæ›´æ–°æœ¬åœ°ç¼“å­˜

## æ³¨æ„äº‹é¡¹

1. **é»˜è®¤è¡Œä¸º**ï¼šå¦‚æœåç«¯æœªè¿”å› `passwordChanged` å­—æ®µï¼Œé»˜è®¤æ˜¾ç¤ºé»˜è®¤å¯†ç ï¼ˆæ›´å®‰å…¨çš„é€‰æ‹©ï¼‰
2. **æœ¬åœ°ç¼“å­˜**ï¼šä¿®æ”¹å¯†ç åä¼šç«‹å³æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œæ— éœ€ç­‰å¾…ä¸‹æ¬¡ API è°ƒç”¨
3. **ä¸¥æ ¼åˆ¤æ–­**ï¼šä½¿ç”¨ `=== true` ç¡®ä¿åªæœ‰æ˜ç¡®çš„ `true` å€¼æ‰è®¤ä¸ºå¯†ç å·²ä¿®æ”¹
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæ–°ç”¨æˆ·å¯ä»¥çœ‹åˆ°é»˜è®¤å¯†ç ï¼Œæ–¹ä¾¿ä¸‹æ¬¡ç™»å½•ï¼›è€ç”¨æˆ·ä¸ä¼šçœ‹åˆ°ï¼Œä¿æŠ¤éšç§

## ä¸‹ä¸€æ­¥

- [ ] ä¸åç«¯ç¡®è®¤ `passwordChanged` å­—æ®µæ˜¯å¦å·²å®ç°
- [ ] æµ‹è¯•æ–°ç”¨æˆ·æ³¨å†Œåçš„é»˜è®¤å¯†ç æ˜¾ç¤º
- [ ] æµ‹è¯•ä¿®æ”¹å¯†ç åçš„è¡Œä¸º
- [ ] æµ‹è¯•é€€å‡ºç™»å½•åé‡æ–°ç™»å½•çš„è¡Œä¸º
